<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç¿»ç‰Œè®°å¿†åŠ›æ¸¸æˆï¼ˆ4Ã—4ï¼‰</title>
  <style>
    :root{--gap:12px;--card-size:90px;--smiley-font:28px}
    body{font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:24px; background:#f7fafc; color:#111}
    header{display:flex;flex-direction:column;align-items:center;gap:8px;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    #victory{color:#c92a2a;font-weight:700;font-size:48px;display:none}

    .controls{display:flex;gap:10px;align-items:center}
    button{padding:10px 14px;border-radius:8px;border:1px solid #ddd;background:white;cursor:pointer;font-weight:600}
    button:disabled{opacity:.5;cursor:not-allowed}

    .board{width:calc(var(--card-size)*4 + var(--gap)*3);max-width:100%;display:grid;grid-template-columns:repeat(4,1fr);grid-gap:var(--gap);margin:18px auto}

    .card{width:100%;aspect-ratio:1/1;position:relative;perspective:800px}
    .inner{position:absolute;inset:0;transition:transform .5s;transform-style:preserve-3d;border-radius:12px}
    .card.flipped .inner{transform:rotateY(180deg)}

    .face{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;border-radius:12px;backface-visibility:hidden;box-shadow:0 4px 8px rgba(2,6,23,.08)}
    .front{background:#fff;border:1px solid #e6eef6;font-size:18px;padding:6px;transform:rotateY(180deg);}
    .back{background:linear-gradient(180deg,#e6f2ff,#dbeefb);border:1px solid #cfe6ff;font-size:var(--smiley-font)}

    .hidden{visibility:hidden}
    #status{margin-top:6px;text-align:center;color:#444}

    @media (max-width:420px){:root{--card-size:76px;--gap:8px} #victory{font-size:36px}}
  </style>
</head>
<body>
  <header>
    <h1>ç¿»ç‰Œè®°å¿†åŠ›æ¸¸æˆï¼ˆ4Ã—4ï¼‰</h1>
    <div id="victory">èƒœåˆ©</div>
    <div class="controls">
      <button id="dealBtn">å‘ç‰Œ</button>
      <button id="startBtn" disabled>å¼€å§‹</button>
      <div id="status">è¯·å…ˆç‚¹å‡»â€œå‘ç‰Œâ€æ¥å‘æ”¾å•è¯ã€‚</div>
    </div>
  </header>

  <main>
    <div class="board" id="board" aria-live="polite"></div>
  </main>

  <script>
    // è¯åº“ï¼ˆé€‚åˆä¸‰å¹´çº§çš„å¸¸è§è‹±æ–‡å•è¯ï¼‰
    const WORD_BANK = [
      'cat','dog','book','school','water','apple','chair','table',
      'house','tree','friend','family','teacher','music','pencil','lunch'
    ];

    const boardEl = document.getElementById('board');
    const dealBtn = document.getElementById('dealBtn');
    const startBtn = document.getElementById('startBtn');
    const statusEl = document.getElementById('status');
    const victoryEl = document.getElementById('victory');

    let cards = []; // {word, id, matched}
    let firstPick = null;
    let secondPick = null;
    let clickable = false;
    let revealedDuringStart = false;

    function shuffleArray(a){
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function makePairs(){
      // choose 8 distinct words from bank
      const pool = [...WORD_BANK];
      shuffleArray(pool);
      const chosen = pool.slice(0,8);
      const pairList = [];
      chosen.forEach(w=>{pairList.push(w);pairList.push(w)});
      shuffleArray(pairList);
      cards = pairList.map((word,idx)=>({word, id:idx, matched:false}));
    }

    function renderBoard(showFront=false){
      boardEl.innerHTML = '';
      cards.forEach((c, idx)=>{
        const card = document.createElement('div');
        card.className = 'card' + (showFront ? ' flipped' : '');
        card.dataset.index = idx;
        card.setAttribute('role','button');
        card.setAttribute('aria-label', showFront ? ('å•è¯ï¼š'+c.word) : 'èƒŒé¢å¡ç‰‡');

        const inner = document.createElement('div'); inner.className='inner';
        const faceFront = document.createElement('div'); faceFront.className='face front'; faceFront.textContent = c.word;
        const faceBack = document.createElement('div'); faceBack.className='face back'; faceBack.textContent = 'ğŸ˜Š';

        inner.appendChild(faceFront); inner.appendChild(faceBack);
        card.appendChild(inner);

        if(c.matched) card.classList.add('flipped');

        card.addEventListener('click', onCardClick);
        boardEl.appendChild(card);
      });
    }

    function onCardClick(e){
      if(!clickable) return;
      const cardEl = e.currentTarget;
      const idx = Number(cardEl.dataset.index);
      const cardObj = cards[idx];
      if(cardObj.matched) return; // already matched
      if(cardEl.classList.contains('flipped')) return; // already face up

      flipUp(cardEl);

      if(!firstPick){ firstPick = {idx, el:cardEl}; return; }
      if(firstPick && firstPick.idx === idx) return; // same card

      secondPick = {idx, el:cardEl};
      clickable = false; // lock until evaluation

      const w1 = cards[firstPick.idx].word;
      const w2 = cards[secondPick.idx].word;

      if(w1 === w2){
        // match
        cards[firstPick.idx].matched = true;
        cards[secondPick.idx].matched = true;
        setTimeout(()=>{
          firstPick = null; secondPick = null; clickable = true; checkVictory();
        }, 600);
      } else {
        // not match -> flip back after short delay
        setTimeout(()=>{
          flipDown(firstPick.el);
          flipDown(secondPick.el);
          firstPick = null; secondPick = null; clickable = true;
        }, 800);
      }
    }

    function flipUp(cardEl){
      cardEl.classList.add('flipped');
    }
    function flipDown(cardEl){
      cardEl.classList.remove('flipped');
    }

    function checkVictory(){
      const allMatched = cards.every(c=>c.matched);
      if(allMatched){
        victoryEl.style.display = 'block';
        statusEl.textContent = 'æ­å–œä½ ï¼Œå…¨éƒ¨é…å¯¹å®Œæˆï¼';
        clickable = false;
      }
    }

    // å‘ç‰ŒæŒ‰é’®ï¼šç”Ÿæˆæ–°ç‰Œå¹¶å…¨éƒ¨æ­£é¢æœä¸Šï¼Œæ˜¾ç¤ºéšæœº8ç»„å•è¯
    dealBtn.addEventListener('click', ()=>{
      makePairs();
      victoryEl.style.display='none';
      renderBoard(true);
      statusEl.textContent = 'å·²å‘ç‰Œï¼šè§‚å¯Ÿå•è¯ï¼Œç„¶åç‚¹å‡»â€œå¼€å§‹â€å¼€å§‹æ¸¸æˆã€‚';
      startBtn.disabled = false;
      clickable = false;
      firstPick = null; secondPick = null;
      revealedDuringStart = true;
    });

    // å¼€å§‹æŒ‰é’®ï¼šå…ˆæŠŠæ‰€æœ‰ç¿»å›èƒŒé¢ï¼Œæ˜¾ç¤ºç¬‘è„¸ï¼Œç„¶åæ˜¾ç¤º10ç§’åå†ç¿»åˆ°èƒŒé¢ï¼ˆé¢˜æ„è¦æ±‚ï¼šå½“ç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®åï¼Œæ‰€å¶ç‰Œæ­£é¢æœä¸Šï¼Œæ˜¾ç¤º10ç§’åï¼Œå†ç¿»è½¬åˆ°èƒŒé¢ã€‚ï¼‰
    startBtn.addEventListener('click', ()=>{
      if(cards.length!==16) return;
      victoryEl.style.display='none';
      statusEl.textContent = 'å‡†å¤‡ä¸­ï¼š10ç§’åå¼€å§‹æ¸¸æˆï¼Œè¯·è®°ä½å•è¯ä½ç½®ã€‚';
      // ensure all face up briefly, then flip to back after 10s
      renderBoard(true);
      startBtn.disabled = true; dealBtn.disabled = true;
      // give 10 seconds of visibility
      setTimeout(()=>{
        // flip all to back
        document.querySelectorAll('.card').forEach(c=>c.classList.remove('flipped'));
        statusEl.textContent = 'å¼€å§‹ï¼è¯·ç¿»ç‰Œé…å¯¹ã€‚';
        clickable = true;
        dealBtn.disabled = false;
      }, 10000);
    });

    // Initialize empty board
    function initEmpty(){
      cards = Array.from({length:16}).map((_,i)=>({word:'',id:i,matched:false}));
      boardEl.innerHTML = '';
      for(let i=0;i<16;i++){
        const card = document.createElement('div'); card.className='card'; card.dataset.index=i;
        const inner = document.createElement('div'); inner.className='inner';
        const faceFront = document.createElement('div'); faceFront.className='face front'; faceFront.textContent = '';
        const faceBack = document.createElement('div'); faceBack.className='face back'; faceBack.textContent = 'ğŸ˜Š';
        inner.appendChild(faceFront); inner.appendChild(faceBack); card.appendChild(inner);
        boardEl.appendChild(card);
      }
    }

    // load
    initEmpty();
  </script>
</body>
</html>
